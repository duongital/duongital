---
import { getCollection } from 'astro:content'

import Header from '../../components/Header.astro'
import BaseHead from '../../components/BaseHead.astro'
import TableOfContents from '../../components/TableOfContents.astro'

export async function getStaticPaths() {
  const blogEntries = await getCollection('notes')
  return blogEntries.map((entry) => ({
    params: { slug: entry.slug },
    props: { entry },
  }))
}

const { entry } = Astro.props
const { Content, headings } = await entry.render()
---

<html data-theme="lemonade" lang="en">
  <head>
    <BaseHead
      title={entry.data.title || entry.slug}
      description={entry.data.description || entry.body.substring(0, 127)}
    />
  </head>

  <body class="blog">
    <div class="header-wrapper">
      <Header />
    </div>
    <div class="page-container">
      <main class="main-content">
        <h1 class="text-primary">{entry.data.title}</h1>
        <blockquote>{entry.data.description}</blockquote>
        <article>
          <Content />
        </article>
      </main>
      <aside class="toc-sidebar">
        <TableOfContents headings={headings} />
      </aside>
    </div>
  </body>
</html>

<style>
  .header-wrapper {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 1rem;
  }

  .page-container {
    display: grid;
    grid-template-columns: 1fr;
    gap: 2rem;
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 1rem;
  }

  .main-content {
    max-width: 65ch;
    width: 100%;
  }

  .toc-sidebar {
    display: none;
  }

  /* Desktop layout with TOC on the right */
  @media (min-width: 1024px) {
    .header-wrapper {
      padding: 0 2rem;
    }

    .page-container {
      grid-template-columns: minmax(0, 1fr) 300px;
      padding: 0 2rem;
    }

    .toc-sidebar {
      display: block;
    }
  }

  /* Larger screens - give more room to content */
  @media (min-width: 1280px) {
    .page-container {
      grid-template-columns: minmax(0, 1fr) 350px;
    }
  }
</style>
